{
  "id": "fallenmax-1",
  "title": "FallenMax's Setup",
  "author": "FallenMax",
  "authorUrl": "https://github.com/FallenMax",
  "description": "A SketchyBar configuration shared by FallenMax in the community showcase thread.",
  "screenshots": [
    "/screenshots/fallenmax-1/main.png"
  ],
  "thumbnail": "/screenshots/fallenmax-1/main.png",
  "mode": "dark",
  "tags": [
    "custom"
  ],
  "githubUrl": "https://github.com/FallenMax/sketchybar-config",
  "dependencies": [
    "sketchybar"
  ],
  "dotfiles": {
    ".gitignore": "*.lock\n*.mjs\nnode_modules\n",
    ".yabairc": "#!/usr/bin/env sh\n\n# ... other stuff irrelevant to this example ...\n\n# https://github.com/koekeishiya/yabai/blob/master/doc/yabai.asciidoc#signal\nEVENTS_FOR_BAR=(\n  # application_launched\n  # application_terminated\n  # application_front_switched\n  # application_activated\n  # application_deactivated\n  application_visible\n  application_hidden\n  window_created\n  window_destroyed\n  # window_focused\n  # window_moved\n  # window_resized\n  window_minimized\n  window_deminimized\n  window_title_changed\n  space_changed\n  display_added\n  display_removed\n  # display_moved\n  # display_resized\n  # display_changed\n  # mission_control_enter\n  # mission_control_exit\n  # dock_did_restart\n  # menu_bar_hidden_changed\n  # dock_did_change_pref\n)\n\n# require flock: https://github.com/discoteq/flock\n\nfor event in \"${EVENTS_FOR_BAR[@]}\"; do\n  echo \"registering $event for update_schetchybar\"\n\n  # patch $PATH so zx/node can be located by yabai\n  yabai -m signal --add \\\n    event=\"$event\" \\\n    label=\"update_sketchybar__${event}\" \\\n    action=\"echo 'event:' $event && export PATH=$PATH:/usr/local/bin:/opt/homebrew/bin/:/Users/YOUR_USERNAME/Library/pnpm && flock -nE 0 /Users/YOUR_USERNAME/.config/sketchybar/update_sketchybar.lock /Users/YOUR_USERNAME/.config/sketchybar/update_sketchybar.mjs --quiet\"\ndone\nexport PATH=$PATH:/usr/local/bin:/opt/homebrew/bin/:/Users/YOUR_USERNAME/Library/pnpm && /Users/YOUR_USERNAME/.config/sketchybar/update_sketchybar.mjs --quiet\n",
    "README.md": "My SketchyBar setup mentioned at https://github.com/FelixKratz/SketchyBar/discussions/47#discussioncomment-4808906\n\n![screenshot](./screenshot.png)\n\nFeatures\n\n- Displays app titles and updates on change (with animation ✨)\n  - Instead of using spaces for fixed purposes, I allocate any new task to a free space. So it's nice to know how spaces are used and their purpose from a glance\n- Co-exists with macOS native menubar\n  - Native menubar is useful, also I'm using [MenubarX](https://menubarx.app/)\n- Written in TypeScript\n  - Easier to maintain for complex logic (a.k.a. I can't write bash)\n\nUsage:\n\n- Install required dependencies:\n  - node.js (run `npm install` or using yarn/pnpm)\n  - yabai (query window info)\n  - [flock](https://github.com/discoteq/flock) (to prevent multiple instances of the script)\n- Modify code to your liking\n  - Be sure to replace _\"YOUR_USERNAME\"_ to your own\n\nKnown issues:\n\n- ~~After upgrading macos to Ventura, bar items jitter when update, no idea how to fix it yet~~\n- Does not update when moving a window to another space using yabai, yabai seems not emit any event when this happens: [#1272](https://github.com/koekeishiya/yabai/issues/1272)\n",
    "makefile": "\nbuild:\n\t# use esbuild to build src/*.ts -> update_sketchybar.mjs\n\t@echo \"build\"\n\tesbuild --bundle --target=esnext --format=esm --outfile=update_sketchybar.mjs  --platform=node --external:zx src/update_sketchybar.ts \n\nconfig:\n\t@echo \"apply config\"\n\tbrew services restart sketchybar \n\t./update_sketchybar.mjs\n\nwatch:\n  # https://stackoverflow.com/questions/3004811/how-do-you-run-multiple-programs-in-parallel-from-a-bash-script\n\t@echo \"start watching\"\n\t( \\\n\t\ttrap 'kill 0' SIGINT; \\\n\t\tchokidar 'src/*.ts' -c 'make build' & \\\n\t\tchokidar 'sketchybarrc' -c 'brew services restart sketchybar' & \\\n\t\tchokidar '*.mjs' -c './update_sketchybar.mjs' \\\n\t)\n",
    "package.json": "{\n  \"name\": \"sketchybar-config\",\n  \"type\": \"module\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n  },\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"dependencies\": {\n    \"zx\": \"^7.1.1\"\n  },\n  \"devDependencies\": {\n    \"chokidar-cli\": \"^3.0.0\",\n    \"typescript\": \"^4.9.5\"\n  }\n}\n",
    "pnpm-lock.yaml": "lockfileVersion: '6.0'\n\nsettings:\n  autoInstallPeers: true\n  excludeLinksFromLockfile: false\n\ndependencies:\n  zx:\n    specifier: ^7.1.1\n    version: 7.1.1\n\ndevDependencies:\n  chokidar-cli:\n    specifier: ^3.0.0\n    version: 3.0.0\n  typescript:\n    specifier: ^4.9.5\n    version: 4.9.5\n\npackages:\n\n  /@nodelib/fs.scandir@2.1.5:\n    resolution: {integrity: sha512-vq24Bq3ym5HEQm2NKCr3yXDwjc7vTsEThRDnkp2DK9p1uqLR+DHurm/NOTo0KG7HYHU7eppKZj3MyqYuMBf62g==}\n    engines: {node: '>= 8'}\n    dependencies:\n      '@nodelib/fs.stat': 2.0.5\n      run-parallel: 1.2.0\n    dev: false\n\n  /@nodelib/fs.stat@2.0.5:\n    resolution: {integrity: sha512-RkhPPp2zrqDAQA/2jNhnztcPAlv64XdhIp7a7454A5ovI7Bukxgt7MX7udwAu3zg1DcpPU0rz3VV1SeaqvY4+A==}\n    engines: {node: '>= 8'}\n    dev: false\n\n  /@nodelib/fs.walk@1.2.8:\n    resolution: {integrity: sha512-oGB+UxlgWcgQkgwo8GcEGwemoTFt3FIO9ababBmaGwXIoBKZ+GTy0pP185beGg7Llih/NSHSV2XAs1lnznocSg==}\n    engines: {node: '>= 8'}\n    dependencies:\n      '@nodelib/fs.scandir': 2.1.5\n      fastq: 1.15.0\n    dev: false\n\n  /@types/fs-extra@9.0.13:\n    resolution: {integrity: sha512-nEnwB++1u5lVDM2UI4c1+5R+FYaKfaAzS4OococimjVm3nQw3TuzH5UNsocrcTBbhnerblyHj4A49qXbIiZdpA==}\n    dependencies:\n      '@types/node': 18.11.18\n    dev: false\n\n  /@types/minimist@1.2.2:\n    resolution: {integrity: sha512-jhuKLIRrhvCPLqwPcx6INqmKeiA5EWrsCOPhrlFSrbrmU4ZMPjj5Ul/oLCMDO98XRUIwVm78xICz4EPCektzeQ==}\n    dev: false\n\n  /@types/node@18.11.18:\n    resolution: {integrity: sha512-DHQpWGjyQKSHj3ebjFI/wRKcqQcdR+MoFBygntYOZytCqNfkd2ZC4ARDJ2DQqhjH5p85Nnd3jhUJIXrszFX/JA==}\n    dev: false\n\n  /@types/ps-tree@1.1.2:\n    resolution: {integrity: sha512-ZREFYlpUmPQJ0esjxoG1fMvB2HNaD3z+mjqdSosZvd3RalncI9NEur73P8ZJz4YQdL64CmV1w0RuqoRUlhQRBw==}\n    dev: false\n\n  /@types/which@2.0.1:\n    resolution: {integrity: sha512-Jjakcv8Roqtio6w1gr0D7y6twbhx6gGgFGF5BLwajPpnOIOxFkakFhCq+LmyyeAz7BX6ULrjBOxdKaCDy+4+dQ==}\n    dev: false\n\n  /ansi-regex@4.1.1:\n    resolution: {integrity: sha512-ILlv4k/3f6vfQ4OoP2AGvirOktlQ98ZEL1k9FaQjxa3L1abBgbuTDAdPOpvbGncC0BTVQrl+OM8xZGK6tWXt7g==}\n    engines: {node: '>=6'}\n    dev: true\n\n  /ansi-styles@3.2.1:\n    resolution: {integrity: sha512-VT0ZI6kZRdTh8YyJw3SMbYm/u+NqfsAxEpWO0Pf9sq8/e94WxxOpPKx9FR1FlyCtOVDNOQ+8ntlqFxiRc+r5qA==}\n    engines: {node: '>=4'}\n    dependencies:\n      color-convert: 1.9.3\n    dev: true\n\n  /anymatch@3.1.3:\n    resolution: {integrity: sha512-KMReFUr0B4t+D+OBkjR3KYqvocp2XaSzO55UcB6mgQMd3KbcE+mWTyvVV7D/zsdEbNnV6acZUutkiHQXvTr1Rw==}\n    engines: {node: '>= 8'}\n    dependencies:\n      normalize-path: 3.0.0\n      picomatch: 2.3.1\n    dev: true\n\n  /binary-extensions@2.2.0:\n    resolution: {integrity: sha512-jDctJ/IVQbZoJykoeHbhXpOlNBqGNcwXJKJog42E5HDPUwQTSdjCHdihjj0DlnheQ7blbT6dHOafNAiS8ooQKA==}\n    engines: {node: '>=8'}\n    dev: true\n\n  /braces@3.0.2:\n    resolution: {integrity: sha512-b8um+L1RzM3WDSzvhm6gIz1yfTbBt6YTlcEKAvsmqCZZFw46z626lVj9j1yEPW33H5H+lBQpZMP1k8l+78Ha0A==}\n    engines: {node: '>=8'}\n    dependencies:\n      fill-range: 7.0.1\n\n  /camelcase@5.3.1:\n    resolution: {integrity: sha512-L28STB170nwWS63UjtlEOE3dldQApaJXZkOI1uMFfzf3rRuPegHaHesyee+YxQ+W6SvRDQV6UrdOdRiR153wJg==}\n    engines: {node: '>=6'}\n    dev: true\n\n  /chalk@5.2.0:\n    resolution: {integrity: sha512-ree3Gqw/nazQAPuJJEy+avdl7QfZMcUvmHIKgEZkGL+xOBzRvup5Hxo6LHuMceSxOabuJLJm5Yp/92R9eMmMvA==}\n    engines: {node: ^12.17.0 || ^14.13 || >=16.0.0}\n    dev: false\n\n  /chokidar-cli@3.0.0:\n    resolution: {integrity: sha512-xVW+Qeh7z15uZRxHOkP93Ux8A0xbPzwK4GaqD8dQOYc34TlkqUhVSS59fK36DOp5WdJlrRzlYSy02Ht99FjZqQ==}\n    engines: {node: '>= 8.10.0'}\n    hasBin: true\n    dependencies:\n      chokidar: 3.5.3\n      lodash.debounce: 4.0.8\n      lodash.throttle: 4.1.1\n      yargs: 13.3.2\n    dev: true\n\n  /chokidar@3.5.3:\n    resolution: {integrity: sha512-Dr3sfKRP6oTcjf2JmUmFJfeVMvXBdegxB0iVQ5eb2V10uFJUCAS8OByZdVAyVb8xXNz3GjjTgj9kLWsZTqE6kw==}\n    engines: {node: '>= 8.10.0'}\n    dependencies:\n      anymatch: 3.1.3\n      braces: 3.0.2\n      glob-parent: 5.1.2\n      is-binary-path: 2.1.0\n      is-glob: 4.0.3\n      normalize-path: 3.0.0\n      readdirp: 3.6.0\n    optionalDependencies:\n      fsevents: 2.3.2\n    dev: true\n\n  /cliui@5.0.0:\n    resolution: {integrity: sha512-PYeGSEmmHM6zvoef2w8TPzlrnNpXIjTipYK780YswmIP9vjxmd6Y2a3CB2Ks6/AU8NHjZugXvo8w3oWM2qnwXA==}\n    dependencies:\n      string-width: 3.1.0\n      strip-ansi: 5.2.0\n      wrap-ansi: 5.1.0\n    dev: true\n\n  /color-convert@1.9.3:\n    resolution: {integrity: sha512-QfAUtd+vFdAtFQcC8CCyYt1fYWxSqAiK2cSD6zDB8N3cpsEBAvRxp9zOGg6G/SHHJYAT88/az/IuDGALsNVbGg==}\n    dependencies:\n      color-name: 1.1.3\n    dev: true\n\n  /color-name@1.1.3:\n    resolution: {integrity: sha512-72fSenhMw2HZMTVHeCA9KCmpEIbzWiQsjN+BHcBbS9vr1mtt+vJjPdksIBNUmKAW8TFUDPJK5SUU3QhE9NEXDw==}\n    dev: true\n\n  /data-uri-to-buffer@4.0.1:\n    resolution: {integrity: sha512-0R9ikRb668HB7QDxT1vkpuUBtqc53YyAwMwGeUFKRojY/NWKvdZ+9UYtRfGmhqNbRkTSVpMbmyhXipFFv2cb/A==}\n    engines: {node: '>= 12'}\n    dev: false\n\n  /decamelize@1.2.0:\n    resolution: {integrity: sha512-z2S+W9X73hAUUki+N+9Za2lBlun89zigOyGrsax+KUQ6wKW4ZoWpEYBkGhQjwAjjDCkWxhY0VKEhk8wzY7F5cA==}\n    engines: {node: '>=0.10.0'}\n    dev: true\n\n  /dir-glob@3.0.1:\n    resolution: {integrity: sha512-WkrWp9GR4KXfKGYzOLmTuGVi1UWFfws377n9cc55/tb6DuqyF6pcQ5AbiHEshaDpY9v6oaSr2XCDidGmMwdzIA==}\n    engines: {node: '>=8'}\n    dependencies:\n      path-type: 4.0.0\n    dev: false\n\n  /duplexer@0.1.2:\n    resolution: {integrity: sha512-jtD6YG370ZCIi/9GTaJKQxWTZD045+4R4hTk/x1UyoqadyJ9x9CgSi1RlVDQF8U2sxLLSnFkCaMihqljHIWgMg==}\n    dev: false\n\n  /emoji-regex@7.0.3:\n    resolution: {integrity: sha512-CwBLREIQ7LvYFB0WyRvwhq5N5qPhc6PMjD6bYggFlI5YyDgl+0vxq5VHbMOFqLg7hfWzmu8T5Z1QofhmTIhItA==}\n    dev: true\n\n  /event-stream@3.3.4:\n    resolution: {integrity: sha512-QHpkERcGsR0T7Qm3HNJSyXKEEj8AHNxkY3PK8TS2KJvQ7NiSHe3DDpwVKKtoYprL/AreyzFBeIkBIWChAqn60g==}\n    dependencies:\n      duplexer: 0.1.2\n      from: 0.1.7\n      map-stream: 0.1.0\n      pause-stream: 0.0.11\n      split: 0.3.3\n      stream-combiner: 0.0.4\n      through: 2.3.8\n    dev: false\n\n  /fast-glob@3.2.12:\n    resolution: {integrity: sha512-DVj4CQIYYow0BlaelwK1pHl5n5cRSJfM60UA0zK891sVInoPri2Ekj7+e1CT3/3qxXenpI+nBBmQAcJPJgaj4w==}\n    engines: {node: '>=8.6.0'}\n    dependencies:\n      '@nodelib/fs.stat': 2.0.5\n      '@nodelib/fs.walk': 1.2.8\n      glob-parent: 5.1.2\n      merge2: 1.4.1\n      micromatch: 4.0.5\n    dev: false\n\n  /fastq@1.15.0:\n    resolution: {integrity: sha512-wBrocU2LCXXa+lWBt8RoIRD89Fi8OdABODa/kEnyeyjS5aZO5/GNvI5sEINADqP/h8M29UHTHUb53sUu5Ihqdw==}\n    dependencies:\n      reusify: 1.0.4\n    dev: false\n\n  /fetch-blob@3.2.0:\n    resolution: {integrity: sha512-7yAQpD2UMJzLi1Dqv7qFYnPbaPx7ZfFK6PiIxQ4PfkGPyNyl2Ugx+a/umUonmKqjhM4DnfbMvdX6otXq83soQQ==}\n    engines: {node: ^12.20 || >= 14.13}\n    dependencies:\n      node-domexception: 1.0.0\n      web-streams-polyfill: 3.2.1\n    dev: false\n\n  /fill-range@7.0.1:\n    resolution: {integrity: sha512-qOo9F+dMUmC2Lcb4BbVvnKJxTPjCm+RRpe4gDuGrzkL7mEVl/djYSu2OdQ2Pa302N4oqkSg9ir6jaLWJ2USVpQ==}\n    engines: {node: '>=8'}\n    dependencies:\n      to-regex-range: 5.0.1\n\n  /find-up@3.0.0:\n    resolution: {integrity: sha512-1yD6RmLI1XBfxugvORwlck6f75tYL+iR0jqwsOrOxMZyGYqUuDhJ0l4AXdO1iX/FTs9cBAMEk1gWSEx1kSbylg==}\n    engines: {node: '>=6'}\n    dependencies:\n      locate-path: 3.0.0\n    dev: true\n\n  /formdata-polyfill@4.0.10:\n    resolution: {integrity: sha512-buewHzMvYL29jdeQTVILecSaZKnt/RJWjoZCF5OW60Z67/GmSLBkOFM7qh1PI3zFNtJbaZL5eQu1vLfazOwj4g==}\n    engines: {node: '>=12.20.0'}\n    dependencies:\n      fetch-blob: 3.2.0\n    dev: false\n\n  /from@0.1.7:\n    resolution: {integrity: sha512-twe20eF1OxVxp/ML/kq2p1uc6KvFK/+vs8WjEbeKmV2He22MKm7YF2ANIt+EOqhJ5L3K/SuuPhk0hWQDjOM23g==}\n    dev: false\n\n  /fs-extra@10.1.0:\n    resolution: {integrity: sha512-oRXApq54ETRj4eMiFzGnHWGy+zo5raudjuxN0b8H7s/RU2oW0Wvsx9O0ACRN/kRq9E8Vu/ReskGB5o3ji+FzHQ==}\n    engines: {node: '>=12'}\n    dependencies:\n      graceful-fs: 4.2.10\n      jsonfile: 6.1.0\n      universalify: 2.0.0\n    dev: false\n\n  /fsevents@2.3.2:\n    resolution: {integrity: sha512-xiqMQR4xAeHTuB9uWm+fFRcIOgKBMiOBP+eXiyT7jsgVCq1bkVygt00oASowB7EdtpOHaaPgKt812P9ab+DDKA==}\n    engines: {node: ^8.16.0 || ^10.6.0 || >=11.0.0}\n    os: [darwin]\n    requiresBuild: true\n    dev: true\n    optional: true\n\n  /get-caller-file@2.0.5:\n    resolution: {integrity: sha512-DyFP3BM/3YHTQOCUL/w0OZHR0lpKeGrxotcHWcqNEdnltqFwXVfhEBQ94eIo34AfQpo0rGki4cyIiftY06h2Fg==}\n    engines: {node: 6.* || 8.* || >= 10.*}\n    dev: true\n\n  /glob-parent@5.1.2:\n    resolution: {integrity: sha512-AOIgSQCepiJYwP3ARnGx+5VnTu2HBYdzbGP45eLw1vr3zB3vZLeyed1sC9hnbcOc9/SrMyM5RPQrkGz4aS9Zow==}\n    engines: {node: '>= 6'}\n    dependencies:\n      is-glob: 4.0.3\n\n  /globby@13.1.3:\n    resolution: {integrity: sha512-8krCNHXvlCgHDpegPzleMq07yMYTO2sXKASmZmquEYWEmCx6J5UTRbp5RwMJkTJGtcQ44YpiUYUiN0b9mzy8Bw==}\n    engines: {node: ^12.20.0 || ^14.13.1 || >=16.0.0}\n    dependencies:\n      dir-glob: 3.0.1\n      fast-glob: 3.2.12\n      ignore: 5.2.4\n      merge2: 1.4.1\n      slash: 4.0.0\n    dev: false\n\n  /graceful-fs@4.2.10:\n    resolution: {integrity: sha512-9ByhssR2fPVsNZj478qUUbKfmL0+t5BDVyjShtyZZLiK7ZDAArFFfopyOTj0M05wE2tJPisA4iTnnXl2YoPvOA==}\n    dev: false\n\n  /ignore@5.2.4:\n    resolution: {integrity: sha512-MAb38BcSbH0eHNBxn7ql2NH/kX33OkB3lZ1BNdh7ENeRChHTYsTvWrMubiIAMNS2llXEEgZ1MUOBtXChP3kaFQ==}\n    engines: {node: '>= 4'}\n    dev: false\n\n  /is-binary-path@2.1.0:\n    resolution: {integrity: sha512-ZMERYes6pDydyuGidse7OsHxtbI7WVeUEozgR/g7rd0xUimYNlvZRE/K2MgZTjWy725IfelLeVcEM97mmtRGXw==}\n    engines: {node: '>=8'}\n    dependencies:\n      binary-extensions: 2.2.0\n    dev: true\n\n  /is-extglob@2.1.1:\n    resolution: {integrity: sha512-SbKbANkN603Vi4jEZv49LeVJMn4yGwsbzZworEoyEiutsN3nJYdbO36zfhGJ6QEDpOZIFkDtnq5JRxmvl3jsoQ==}\n    engines: {node: '>=0.10.0'}\n\n  /is-fullwidth-code-point@2.0.0:\n    resolution: {integrity: sha512-VHskAKYM8RfSFXwee5t5cbN5PZeq1Wrh6qd5bkyiXIf6UQcN6w/A0eXM9r6t8d+GYOh+o6ZhiEnb88LN/Y8m2w==}\n    engines: {node: '>=4'}\n    dev: true\n\n  /is-glob@4.0.3:\n    resolution: {integrity: sha512-xelSayHH36ZgE7ZWhli7pW34hNbNl8Ojv5KVmkJD4hBdD3th8Tfk9vYasLM+mXWOZhFkgZfxhLSnrwRr4elSSg==}\n    engines: {node: '>=0.10.0'}\n    dependencies:\n      is-extglob: 2.1.1\n\n  /is-number@7.0.0:\n    resolution: {integrity: sha512-41Cifkg6e8TylSpdtTpeLVMqvSBEVzTttHvERD741+pnZ8ANv0004MRL43QKPDlK9cGvNp6NZWZUBlbGXYxxng==}\n    engines: {node: '>=0.12.0'}\n\n  /isexe@2.0.0:\n    resolution: {integrity: sha512-RHxMLp9lnKHGHRng9QFhRCMbYAcVpn69smSGcq3f36xjgVVWThj4qqLbTLlq7Ssj8B+fIQ1EuCEGI2lKsyQeIw==}\n    dev: false\n\n  /jsonfile@6.1.0:\n    resolution: {integrity: sha512-5dgndWOriYSm5cnYaJNhalLNDKOqFwyDB/rr1E9ZsGciGvKPs8R2xYGCacuf3z6K1YKDz182fd+fY3cn3pMqXQ==}\n    dependencies:\n      universalify: 2.0.0\n    optionalDependencies:\n      graceful-fs: 4.2.10\n    dev: false\n\n  /locate-path@3.0.0:\n    resolution: {integrity: sha512-7AO748wWnIhNqAuaty2ZWHkQHRSNfPVIsPIfwEOWO22AmaoVrWavlOcMR5nzTLNYvp36X220/maaRsrec1G65A==}\n    engines: {node: '>=6'}\n    dependencies:\n      p-locate: 3.0.0\n      path-exists: 3.0.0\n    dev: true\n\n  /lodash.debounce@4.0.8:\n    resolution: {integrity: sha512-FT1yDzDYEoYWhnSGnpE/4Kj1fLZkDFyqRb7fNt6FdYOSxlUWAtp42Eh6Wb0rGIv/m9Bgo7x4GhQbm5Ys4SG5ow==}\n    dev: true\n\n  /lodash.throttle@4.1.1:\n    resolution: {integrity: sha512-wIkUCfVKpVsWo3JSZlc+8MB5it+2AN5W8J7YVMST30UrvcQNZ1Okbj+rbVniijTWE6FGYy4XJq/rHkas8qJMLQ==}\n    dev: true\n\n  /map-stream@0.1.0:\n    resolution: {integrity: sha512-CkYQrPYZfWnu/DAmVCpTSX/xHpKZ80eKh2lAkyA6AJTef6bW+6JpbQZN5rofum7da+SyN1bi5ctTm+lTfcCW3g==}\n    dev: false\n\n  /merge2@1.4.1:\n    resolution: {integrity: sha512-8q7VEgMJW4J8tcfVPy8g09NcQwZdbwFEqhe/WZkoIzjn/3TGDwtOCYtXGxA3O8tPzpczCCDgv+P2P5y00ZJOOg==}\n    engines: {node: '>= 8'}\n    dev: false\n\n  /micromatch@4.0.5:\n    resolution: {integrity: sha512-DMy+ERcEW2q8Z2Po+WNXuw3c5YaUSFjAO5GsJqfEl7UjvtIuFKO6ZrKvcItdy98dwFI2N1tg3zNIdKaQT+aNdA==}\n    engines: {node: '>=8.6'}\n    dependencies:\n      braces: 3.0.2\n      picomatch: 2.3.1\n    dev: false\n\n  /minimist@1.2.7:\n    resolution: {integrity: sha512-bzfL1YUZsP41gmu/qjrEk0Q6i2ix/cVeAhbCbqH9u3zYutS1cLg00qhrD0M2MVdCcx4Sc0UpP2eBWo9rotpq6g==}\n    dev: false\n\n  /node-domexception@1.0.0:\n    resolution: {integrity: sha512-/jKZoMpw0F8GRwl4/eLROPA3cfcXtLApP0QzLmUT/HuPCZWyB7IY9ZrMeKw2O/nFIqPQB3PVM9aYm0F312AXDQ==}\n    engines: {node: '>=10.5.0'}\n    dev: false\n\n  /node-fetch@3.2.10:\n    resolution: {integrity: sha512-MhuzNwdURnZ1Cp4XTazr69K0BTizsBroX7Zx3UgDSVcZYKF/6p0CBe4EUb/hLqmzVhl0UpYfgRljQ4yxE+iCxA==}\n    engines: {node: ^12.20.0 || ^14.13.1 || >=16.0.0}\n    dependencies:\n      data-uri-to-buffer: 4.0.1\n      fetch-blob: 3.2.0\n      formdata-polyfill: 4.0.10\n    dev: false\n\n  /normalize-path@3.0.0:\n    resolution: {integrity: sha512-6eZs5Ls3WtCisHWp9S2GUy8dqkpGi4BVSz3GaqiE6ezub0512ESztXUwUB6C6IKbQkY2Pnb/mD4WYojCRwcwLA==}\n    engines: {node: '>=0.10.0'}\n    dev: true\n\n  /p-limit@2.3.0:\n    resolution: {integrity: sha512-//88mFWSJx8lxCzwdAABTJL2MyWB12+eIY7MDL2SqLmAkeKU9qxRvWuSyTjm3FUmpBEMuFfckAIqEaVGUDxb6w==}\n    engines: {node: '>=6'}\n    dependencies:\n      p-try: 2.2.0\n    dev: true\n\n  /p-locate@3.0.0:\n    resolution: {integrity: sha512-x+12w/To+4GFfgJhBEpiDcLozRJGegY+Ei7/z0tSLkMmxGZNybVMSfWj9aJn8Z5Fc7dBUNJOOVgPv2H7IwulSQ==}\n    engines: {node: '>=6'}\n    dependencies:\n      p-limit: 2.3.0\n    dev: true\n\n  /p-try@2.2.0:\n    resolution: {integrity: sha512-R4nPAVTAU0B9D35/Gk3uJf/7XYbQcyohSKdvAxIRSNghFl4e71hVoGnBNQz9cWaXxO2I10KTC+3jMdvvoKw6dQ==}\n    engines: {node: '>=6'}\n    dev: true\n\n  /path-exists@3.0.0:\n    resolution: {integrity: sha512-bpC7GYwiDYQ4wYLe+FA8lhRjhQCMcQGuSgGGqDkg/QerRWw9CmGRT0iSOVRSZJ29NMLZgIzqaljJ63oaL4NIJQ==}\n    engines: {node: '>=4'}\n    dev: true\n\n  /path-type@4.0.0:\n    resolution: {integrity: sha512-gDKb8aZMDeD/tZWs9P6+q0J9Mwkdl6xMV8TjnGP3qJVJ06bdMgkbBlLU8IdfOsIsFz2BW1rNVT3XuNEl8zPAvw==}\n    engines: {node: '>=8'}\n    dev: false\n\n  /pause-stream@0.0.11:\n    resolution: {integrity: sha512-e3FBlXLmN/D1S+zHzanP4E/4Z60oFAa3O051qt1pxa7DEJWKAyil6upYVXCWadEnuoqa4Pkc9oUx9zsxYeRv8A==}\n    dependencies:\n      through: 2.3.8\n    dev: false\n\n  /picomatch@2.3.1:\n    resolution: {integrity: sha512-JU3teHTNjmE2VCGFzuY8EXzCDVwEqB2a8fsIvwaStHhAWJEeVd1o1QD80CU6+ZdEXXSLbSsuLwJjkCBWqRQUVA==}\n    engines: {node: '>=8.6'}\n\n  /ps-tree@1.2.0:\n    resolution: {integrity: sha512-0VnamPPYHl4uaU/nSFeZZpR21QAWRz+sRv4iW9+v/GS/J5U5iZB5BNN6J0RMoOvdx2gWM2+ZFMIm58q24e4UYA==}\n    engines: {node: '>= 0.10'}\n    hasBin: true\n    dependencies:\n      event-stream: 3.3.4\n    dev: false\n\n  /queue-microtask@1.2.3:\n    resolution: {integrity: sha512-NuaNSa6flKT5JaSYQzJok04JzTL1CA6aGhv5rfLW3PgqA+M2ChpZQnAC8h8i4ZFkBS8X5RqkDBHA7r4hej3K9A==}\n    dev: false\n\n  /readdirp@3.6.0:\n    resolution: {integrity: sha512-hOS089on8RduqdbhvQ5Z37A0ESjsqz6qnRcffsMU3495FuTdqSm+7bhJ29JvIOsBDEEnan5DPu9t3To9VRlMzA==}\n    engines: {node: '>=8.10.0'}\n    dependencies:\n      picomatch: 2.3.1\n    dev: true\n\n  /require-directory@2.1.1:\n    resolution: {integrity: sha512-fGxEI7+wsG9xrvdjsrlmL22OMTTiHRwAMroiEeMgq8gzoLC/PQr7RsRDSTLUg/bZAZtF+TVIkHc6/4RIKrui+Q==}\n    engines: {node: '>=0.10.0'}\n    dev: true\n\n  /require-main-filename@2.0.0:\n    resolution: {integrity: sha512-NKN5kMDylKuldxYLSUfrbo5Tuzh4hd+2E8NPPX02mZtn1VuREQToYe/ZdlJy+J3uCpfaiGF05e7B8W0iXbQHmg==}\n    dev: true\n\n  /reusify@1.0.4:\n    resolution: {integrity: sha512-U9nH88a3fc/ekCF1l0/UP1IosiuIjyTh7hBvXVMHYgVcfGvt897Xguj2UOLDeI5BG2m7/uwyaLVT6fbtCwTyzw==}\n    engines: {iojs: '>=1.0.0', node: '>=0.10.0'}\n    dev: false\n\n  /run-parallel@1.2.0:\n    resolution: {integrity: sha512-5l4VyZR86LZ/lDxZTR6jqL8AFE2S0IFLMP26AbjsLVADxHdhB/c0GUsH+y39UfCi3dzz8OlQuPmnaJOMoDHQBA==}\n    dependencies:\n      queue-microtask: 1.2.3\n    dev: false\n\n  /set-blocking@2.0.0:\n    resolution: {integrity: sha512-KiKBS8AnWGEyLzofFfmvKwpdPzqiy16LvQfK3yv/fVH7Bj13/wl3JSR1J+rfgRE9q7xUJK4qvgS8raSOeLUehw==}\n    dev: true\n\n  /slash@4.0.0:\n    resolution: {integrity: sha512-3dOsAHXXUkQTpOYcoAxLIorMTp4gIQr5IW3iVb7A7lFIp0VHhnynm9izx6TssdrIcVIESAlVjtnO2K8bg+Coew==}\n    engines: {node: '>=12'}\n    dev: false\n\n  /split@0.3.3:\n    resolution: {integrity: sha512-wD2AeVmxXRBoX44wAycgjVpMhvbwdI2aZjCkvfNcH1YqHQvJVa1duWc73OyVGJUc05fhFaTZeQ/PYsrmyH0JVA==}\n    dependencies:\n      through: 2.3.8\n    dev: false\n\n  /stream-combiner@0.0.4:\n    resolution: {integrity: sha512-rT00SPnTVyRsaSz5zgSPma/aHSOic5U1prhYdRy5HS2kTZviFpmDgzilbtsJsxiroqACmayynDN/9VzIbX5DOw==}\n    dependencies:\n      duplexer: 0.1.2\n    dev: false\n\n  /string-width@3.1.0:\n    resolution: {integrity: sha512-vafcv6KjVZKSgz06oM/H6GDBrAtz8vdhQakGjFIvNrHA6y3HCF1CInLy+QLq8dTJPQ1b+KDUqDFctkdRW44e1w==}\n    engines: {node: '>=6'}\n    dependencies:\n      emoji-regex: 7.0.3\n      is-fullwidth-code-point: 2.0.0\n      strip-ansi: 5.2.0\n    dev: true\n\n  /strip-ansi@5.2.0:\n    resolution: {integrity: sha512-DuRs1gKbBqsMKIZlrffwlug8MHkcnpjs5VPmL1PAh+mA30U0DTotfDZ0d2UUsXpPmPmMMJ6W773MaA3J+lbiWA==}\n    engines: {node: '>=6'}\n    dependencies:\n      ansi-regex: 4.1.1\n    dev: true\n\n  /through@2.3.8:\n    resolution: {integrity: sha512-w89qg7PI8wAdvX60bMDP+bFoD5Dvhm9oLheFp5O4a2QF0cSBGsBX4qZmadPMvVqlLJBBci+WqGGOAPvcDeNSVg==}\n    dev: false\n\n  /to-regex-range@5.0.1:\n    resolution: {integrity: sha512-65P7iz6X5yEr1cwcgvQxbbIw7Uk3gOy5dIdtZ4rDveLqhrdJP+Li/Hx6tyK0NEb+2GCyneCMJiGqrADCSNk8sQ==}\n    engines: {node: '>=8.0'}\n    dependencies:\n      is-number: 7.0.0\n\n  /typescript@4.9.5:\n    resolution: {integrity: sha512-1FXk9E2Hm+QzZQ7z+McJiHL4NW1F2EzMu9Nq9i3zAaGqibafqYwCVU6WyWAuyQRRzOlxou8xZSyXLEN8oKj24g==}\n    engines: {node: '>=4.2.0'}\n    hasBin: true\n    dev: true\n\n  /universalify@2.0.0:\n    resolution: {integrity: sha512-hAZsKq7Yy11Zu1DE0OzWjw7nnLZmJZYTDZZyEFHZdUhV8FkH5MCfoU1XMaxXovpyW5nq5scPqq0ZDP9Zyl04oQ==}\n    engines: {node: '>= 10.0.0'}\n    dev: false\n\n  /web-streams-polyfill@3.2.1:\n    resolution: {integrity: sha512-e0MO3wdXWKrLbL0DgGnUV7WHVuw9OUvL4hjgnPkIeEvESk74gAITi5G606JtZPp39cd8HA9VQzCIvA49LpPN5Q==}\n    engines: {node: '>= 8'}\n    dev: false\n\n  /which-module@2.0.0:\n    resolution: {integrity: sha512-B+enWhmw6cjfVC7kS8Pj9pCrKSc5txArRyaYGe088shv/FGWH+0Rjx/xPgtsWfsUtS27FkP697E4DDhgrgoc0Q==}\n    dev: true\n\n  /which@2.0.2:\n    resolution: {integrity: sha512-BLI3Tl1TW3Pvl70l3yq3Y64i+awpwXqsGBYWkkqMtnbXgrMD+yj7rhW0kuEDxzJaYXGjEW5ogapKNMEKNMjibA==}\n    engines: {node: '>= 8'}\n    hasBin: true\n    dependencies:\n      isexe: 2.0.0\n    dev: false\n\n  /wrap-ansi@5.1.0:\n    resolution: {integrity: sha512-QC1/iN/2/RPVJ5jYK8BGttj5z83LmSKmvbvrXPNCLZSEb32KKVDJDl/MOt2N01qU2H/FkzEa9PKto1BqDjtd7Q==}\n    engines: {node: '>=6'}\n    dependencies:\n      ansi-styles: 3.2.1\n      string-width: 3.1.0\n      strip-ansi: 5.2.0\n    dev: true\n\n  /y18n@4.0.3:\n    resolution: {integrity: sha512-JKhqTOwSrqNA1NY5lSztJ1GrBiUodLMmIZuLiDaMRJ+itFd+ABVE8XBjOvIWL+rSqNDC74LCSFmlb/U4UZ4hJQ==}\n    dev: true\n\n  /yaml@2.2.1:\n    resolution: {integrity: sha512-e0WHiYql7+9wr4cWMx3TVQrNwejKaEe7/rHNmQmqRjazfOP5W8PB6Jpebb5o6fIapbz9o9+2ipcaTM2ZwDI6lw==}\n    engines: {node: '>= 14'}\n    dev: false\n\n  /yargs-parser@13.1.2:\n    resolution: {integrity: sha512-3lbsNRf/j+A4QuSZfDRA7HRSfWrzO0YjqTJd5kjAq37Zep1CEgaYmrH9Q3GwPiB9cHyd1Y1UwggGhJGoxipbzg==}\n    dependencies:\n      camelcase: 5.3.1\n      decamelize: 1.2.0\n    dev: true\n\n  /yargs@13.3.2:\n    resolution: {integrity: sha512-AX3Zw5iPruN5ie6xGRIDgqkT+ZhnRlZMLMHAs8tg7nRruy2Nb+i5o9bwghAogtM08q1dpr2LVoS8KSTMYpWXUw==}\n    dependencies:\n      cliui: 5.0.0\n      find-up: 3.0.0\n      get-caller-file: 2.0.5\n      require-directory: 2.1.1\n      require-main-filename: 2.0.0\n      set-blocking: 2.0.0\n      string-width: 3.1.0\n      which-module: 2.0.0\n      y18n: 4.0.3\n      yargs-parser: 13.1.2\n    dev: true\n\n  /zx@7.1.1:\n    resolution: {integrity: sha512-5YlTO2AJ+Ku2YuZKSSSqnUKuagcM/f/j4LmHs15O84Ch80Z9gzR09ZK3gR7GV+rc8IFpz2H/XNFtFVmj31yrZA==}\n    engines: {node: '>= 16.0.0'}\n    hasBin: true\n    dependencies:\n      '@types/fs-extra': 9.0.13\n      '@types/minimist': 1.2.2\n      '@types/node': 18.11.18\n      '@types/ps-tree': 1.1.2\n      '@types/which': 2.0.1\n      chalk: 5.2.0\n      fs-extra: 10.1.0\n      globby: 13.1.3\n      minimist: 1.2.7\n      node-fetch: 3.2.10\n      ps-tree: 1.2.0\n      which: 2.0.2\n      yaml: 2.2.1\n    dev: false\n",
    "sketchybarrc": "# https://github.com/FelixKratz/dotfiles\n\nPLUGIN_DIR=\"$HOME/.config/sketchybar/plugins\"\n\nsketchybar --update\n\n/Users/YOUR_USERNAME/.config/sketchybar/update_sketchybar.mjs\n\necho \"sketchybar configuration loaded..\"\n",
    "src/consts.ts": "export const MACOS_MENUBAR_HEIGHT = 24\nexport const SPACES = 5\nexport const ITEMS_IN_SPACE = 5\n",
    "src/sketchybar.ts": "export type Bar = {\n  items: string[]\n}\n",
    "src/update_sketchybar.ts": "#!/usr/bin/env zx\n\nimport { $ } from 'zx'\nimport { Bar } from './sketchybar'\nimport { initialize } from './update_sketchybar_initialize'\nimport { update } from './update_sketchybar_update'\nimport { info } from './utils'\nimport { Display, Space, Window } from './yabai'\n\n/**!\n * this script query windows information on each spaces using yabai, and update\n * sketchybar display\n *\n * bar items structures (they are fixed, so future updates are efficient and\n * animation works correctly):\n *\n * - 5 brackets: \"space.0\" to \"space.4\", each has 5 fixed items representing\n *   either window or spaceName:\n *   - windows: \"space.$s.0\" to \"space.$s.4\"\n *   - gap: \"space.$s.gap\"  (gap item after space, will not be included in\n *     bracket)\n * - a special item to store window information in its id\n *   - this is a hack to quickly store and retrieve previous window information, so that\n *     when we update windows, we can reuse the same `slot` for the same\n *     window to achieve correct animation\n *   - id format: `data.${space0}/${space1}/.../${space4}`\n *     - spaceX: `${yabaiWindowId}:${yabaiWindowId}:0:0:0` // 0 = no window\n *\n * we build the structure on the first run, then update the bar whenever something changes\n *\n * @see\n * - zx: https://github.com/google/zx\n * - sketchybar: https://felixkratz.github.io/SketchyBar/config/bar\n * - yabai: https://github.com/koekeishiya/yabai\n */\n\n$.verbose = false // do not print command\n\nconst main = async () => {\n  const start = Date.now()\n\n  // -------------- query windows/exist bar -----------------\n  const beforeQuery = Date.now()\n  // prettier-ignore\n  const [displays, spaces, windows, bar] = (await Promise.all([\n    $`yabai -m query --displays`,\n    $`yabai -m query --spaces`,\n    $`yabai -m query --windows`,\n    $`sketchybar --query bar`\n  ])).map((obj) => JSON.parse(String(obj))) as [\n    Display[],\n    Space[],\n    Window[],\n    Bar\n  ]\n  info({ displays, spaces, windows, bar })\n\n  const afterQuery = Date.now()\n\n  // -------------- update config -----------------\n  const beforeUpdate = Date.now()\n  const hasInitialized = bar.items.length > 0\n  if (!hasInitialized) {\n    await initialize()\n  }\n  await update(displays, spaces, windows, bar)\n  const afterUpdate = Date.now()\n\n  console.info(`updated sketchybar. total=${Date.now() - start} query=${afterQuery - beforeQuery}ms, update=${afterUpdate - beforeUpdate}ms`)\n}\n\ntry {\n  await main()\n} catch (error) {\n  console.error(error)\n}\n",
    "src/update_sketchybar_initialize.ts": "import { $ } from 'zx'\nimport { ITEMS_IN_SPACE, MACOS_MENUBAR_HEIGHT, SPACES } from './consts'\nimport { info, toDataId, toParams } from './utils'\n\nexport async function initialize() {\n  let args: string[] = []\n  const flush = async () => {\n    info(args)\n    await $`sketchybar ${args}`\n    args = []\n  }\n  const push = (argList: string[]) => {\n    args.push(...argList)\n  }\n\n  // config bar\n  {\n    push([\n      '--bar',\n      ...toParams({\n        color: '0xff131b20',\n        position: 'bottom',\n        height: MACOS_MENUBAR_HEIGHT,\n        margin: 0,\n        y_offset: 0,\n        corner_radius: 5,\n        border_width: 0,\n        blur_radius: 50,\n        padding_left: 0,\n        padding_right: 0,\n        display: 'main',\n        topmost: 'on',\n        sticky: 'on',\n        font_smoothing: 'on',\n      }),\n    ])\n\n    // config item defaults\n    push([\n      '--default',\n      ...toParams({\n        updates: 'when_shown',\n        drawing: 'on',\n        icon: {\n          '': '',\n          drawing: 'on',\n          font: 'Hack Nerd Font:Bold:16.0',\n          color: '0xffffffff',\n          padding_left: 0,\n          padding_right: 0,\n        },\n        label: {\n          '': '',\n          drawing: 'on',\n          font: 'Helvetica:Normal:14.0',\n          color: '0xccffffff',\n          padding_left: 0,\n          padding_right: 0,\n        },\n        background: {\n          drawing: 'on',\n          corner_radius: 2,\n          padding_left: 0,\n          padding_right: 0,\n          color: '0x00ffffff',\n          height: MACOS_MENUBAR_HEIGHT - 2 * 2,\n        },\n      }),\n    ])\n\n    // spaces\n    const labelColor = '0xccffffff'\n    for (let spaceIndex = 0; spaceIndex < SPACES; spaceIndex++) {\n      const spaceId = `space.${spaceIndex}`\n      const items = []\n      // windows in space\n      for (let itemIndex = 0; itemIndex < ITEMS_IN_SPACE; itemIndex++) {\n        const itemId = `space.${spaceIndex}.${itemIndex}`\n        items.push(itemId)\n        push(['--add', 'item', itemId, 'center'])\n        push([\n          '--set',\n          itemId,\n          ...toParams({\n            drawing: 'on',\n            label: {\n              '': '',\n              color: labelColor,\n            },\n            background: {\n              height: 18,\n              color: '0x00ffffff',\n            },\n            // click_script: `\"yabai -m space --focus ${spaceIndex + 1}\"`,\n          }),\n        ])\n      }\n\n      // group background\n      {\n        push(['--add', 'bracket', spaceId, ...items])\n        push([\n          '--set',\n          spaceId,\n          ...toParams({\n            background: {\n              color: '0x18ffffff',\n              corner_radius: 4,\n              height: MACOS_MENUBAR_HEIGHT,\n            },\n          }),\n        ])\n      }\n\n      // gap between spaces\n      {\n        const spaceGapId = `space.${spaceIndex}.gap`\n        push(['--add', 'item', spaceGapId, 'center'])\n        push([\n          '--set',\n          spaceGapId,\n          ...toParams({\n            label: {\n              '': '',\n              padding_left: 4,\n              padding_right: 4,\n            },\n            background: {\n              drawing: 'on',\n              color: '0x00ffffff', // transparent\n              // color: '0xffffffff',\n              padding_left: 0,\n              padding_right: 0,\n            },\n          }),\n        ])\n      }\n    }\n\n    // database\n    {\n      const databaseId = toDataId([])\n      push(['--add', 'item', databaseId, 'center'])\n      push([\n        '--set',\n        databaseId,\n        ...toParams({\n          drawing: 'off',\n        }),\n      ])\n    }\n  }\n\n  await flush()\n}\n",
    "src/update_sketchybar_update.ts": "#!/usr/bin/env zx\n\nimport { $ } from 'zx'\nimport { ITEMS_IN_SPACE, SPACES } from './consts'\nimport { Bar } from './sketchybar'\nimport { fromDataId, info, toDataId, toParams } from './utils'\nimport { Display, Space, Window } from './yabai'\n\n// icons: https://www.nerdfonts.com/cheat-sheet\nconst KNOWN_APPS: KnownApp[] = [\n  {\n    app: 'Google Chrome',\n    icon: '\\udb80\\udeaf',\n    iconColor: '0xfff1bf47',\n    getTitle(window) {\n      const trimmed = window.title.replace(/ - Google Chrome$/, '')\n      return trimmed.substr(0, 10)\n    },\n  },\n  {\n    app: 'Code',\n    icon: '\\udb82\\ude1e',\n    iconColor: '0xff4b9ae9',\n    getTitle(window) {\n      let [fileOrProject, project] = window.title.split(' — ')\n      project = project || fileOrProject\n      return project.substr(0, 10)\n    },\n  },\n  {\n    app: '访达',\n    icon: '\\udb80\\udc36',\n    iconColor: '0xff1abffb',\n  },\n  {\n    app: '微信',\n    icon: '\\udb81\\ude11',\n    iconColor: '0xff10d962',\n    getTitle() {\n      return ''\n    },\n  },\n  {\n    app: 'Alacritty',\n    icon: '\\uf489',\n    iconColor: '0xffcc822e',\n  },\n  {\n    app: 'Spotify',\n    icon: '\\udb81\\udcc7',\n    iconColor: '0xff65d56e',\n  },\n]\n\ntype KnownApp = {\n  app: string\n  icon: string\n  iconColor?: string\n  getTitle?: (window: Window) => string\n}\nexport async function update(displays: Display[], spaces: Space[], windows: Window[], bar: Bar) {\n  const isMacbook = displays.length === 1\n  const windowsById: Record<string, Window> = {}\n  windows.forEach((w) => (windowsById[w.id] = w))\n\n  // prepare params\n  let args: string[] = []\n  const flush = async () => {\n    info(args)\n    await $`sketchybar ${args}`\n    args = []\n  }\n  const push = (argList: string[]) => {\n    args.push(...argList)\n  }\n\n  {\n    // load data\n    const dataIds = bar.items.filter((item) => item.startsWith('data.'))\n    const [dataId] = dataIds\n    const data = (dataId && fromDataId(dataId)) || fromDataId(toDataId([]))\n    info(`old data id`, dataId)\n    info(`old data`, data)\n    if (dataIds.length) {\n      dataIds.forEach((d) => {\n        push(['--remove', d])\n      })\n    }\n\n    // enable animation\n    push(['--animate', 'sin', '10'])\n\n    // config bar\n    push([\n      '--bar',\n      ...toParams({\n        color: isMacbook ? '0xff131b20' : '0x00272823',\n        position: isMacbook ? 'bottom' : 'top', // macbook has notch, so place it at bottom, with a dark bg\n      }),\n    ])\n\n    // update spaces\n    const labelColor = '0xccffffff'\n    for (let spaceIndex = 0; spaceIndex < SPACES; spaceIndex++) {\n      const spaceId = `space.${spaceIndex}`\n      const space = spaces[spaceIndex]\n      const windows = !space\n        ? []\n        : space.windows\n            .map((wId) => windowsById[wId])\n            .filter(Boolean)\n            .filter((w) => KNOWN_APPS.find((app) => app.app === w.app))\n\n      const spaceEmpty = windows.length === 0\n      const spaceActive = space?.['is-visible']\n\n      // here we'll update the same window by reusing the same slot,\n      // then add new windows to available slots, and remove the rest\n      const prevWindowIds = data[spaceIndex]\n\n      // first remove everything\n      const nextWindowIds = prevWindowIds.map((_) => 0)\n\n      // try re-add windows that exists in last render\n      windows.forEach((win) => {\n        const oldIndex = prevWindowIds.indexOf(win.id)\n        if (oldIndex !== -1) {\n          nextWindowIds[oldIndex] = win.id\n        }\n      })\n\n      // then add windows that are new\n      windows.forEach((win) => {\n        const oldIndex = prevWindowIds.indexOf(win.id)\n        if (oldIndex === -1) {\n          const emptyIndex = nextWindowIds.indexOf(0)\n          if (emptyIndex !== -1) {\n            nextWindowIds[emptyIndex] = win.id\n          }\n        }\n      })\n\n      // now that we have the nextWindowIds, we can update the data\n      for (let itemIndex = 0; itemIndex < ITEMS_IN_SPACE; itemIndex++) {\n        const itemId = `space.${spaceIndex}.${itemIndex}`\n        const windowId = nextWindowIds[itemIndex]\n        const window = windowId ? windowsById[windowId] : undefined\n\n        // note: in order for updating to work correctly, when we update a item\n        // (whatever role it has), we need to provide exactly the same set of\n        // params, so that we can override the previous one\n        interface ItemAttributes {\n          icon: {\n            '': string\n            color?: string\n            width: number\n            padding_left: number\n            padding_right: number\n          }\n          label: {\n            '': string\n            color?: string\n            padding_left: number\n            padding_right: number\n          }\n          background: {\n            color: string\n            padding_left: number\n            padding_right: number\n          }\n        }\n        const rightPaddingFix = -3\n\n        // window name / space label / hidden\n        if (spaceEmpty && itemIndex === 0) {\n          const attrs: ItemAttributes = {\n            icon: {\n              '': '',\n              width: 0,\n              padding_left: 0,\n              padding_right: 0,\n            },\n            label: {\n              '': String(space.index),\n              color: labelColor,\n              padding_left: 10,\n              padding_right: 10 + rightPaddingFix,\n            },\n            background: {\n              color: '0x00ffffff',\n              padding_left: 0,\n              padding_right: 0,\n            },\n          }\n          // space label, always takes the first slot\n          // TODO maybe we should use a different item for space label\n          push(['--set', itemId, ...toParams(attrs)])\n        } else if (window) {\n          // window name\n          const matched = KNOWN_APPS.find((app) => app.app === window.app)!\n          const label = matched.getTitle?.(window) ?? window.title.substr(0, 10)\n          const windowFullScreen = window['has-fullscreen-zoom']\n\n          const attrs: ItemAttributes = {\n            icon: {\n              '': matched.icon,\n              width: matched.icon ? 26 : 0,\n              color: matched.iconColor || '0xffffffff',\n              padding_left: 8,\n              padding_right: 4,\n            },\n            label: {\n              '': label,\n              color: spaceActive && windowFullScreen ? '0xc0000000' : spaceActive ? '0xffffffff' : labelColor,\n              padding_left: 4,\n              padding_right: 8,\n            },\n            background: {\n              color: spaceActive && windowFullScreen ? '0xffffffff' : '0x00ffffff',\n              padding_left: 4,\n              padding_right: 4 + rightPaddingFix,\n            },\n          }\n          push(['--set', itemId, ...toParams(attrs)])\n        } else {\n          // hidden\n          const attrs: ItemAttributes = {\n            icon: {\n              '': '',\n              width: 0,\n              padding_left: 0,\n              padding_right: 0,\n            },\n            label: {\n              '': '',\n              padding_left: 0,\n              padding_right: 0,\n            },\n            background: {\n              color: '0x00ffffff',\n              padding_left: 0,\n              padding_right: 0,\n            },\n          }\n          push(['--set', itemId, ...toParams(attrs)])\n        }\n      }\n\n      data[spaceIndex] = nextWindowIds\n\n      // group background\n      {\n        push([\n          '--set',\n          spaceId,\n          ...toParams({\n            background: {\n              // color: hasFullscreenWindow ? (spaceActive ? '0xffffffff' : '0xb0ffffff') : spaceActive ? '0x30ffffff' : '0x00ffffff',\n              color: spaceActive ? '0x30ffffff' : '0x00ffffff',\n              padding_left: 0,\n              padding_right: 0,\n            },\n          }),\n        ])\n      }\n\n      // gap between spaces\n      {\n        const spaceGapId = `space.${spaceIndex}.gap`\n        push([\n          '--set',\n          spaceGapId,\n          ...toParams({\n            label: {\n              '': '|',\n              padding_left: 4,\n              padding_right: 4,\n              color: '0x30ffffff',\n            },\n            background: {\n              // height: MACOS_MENUBAR_HEIGHT,\n              padding_left: 4,\n              padding_right: 4,\n            },\n          }),\n        ])\n      }\n    }\n\n    // store data\n    {\n      const nextDataId = toDataId(data)\n      info(`new data`, data)\n      push(['--add', 'item', nextDataId, 'center'])\n      push([\n        '--set',\n        nextDataId,\n        ...toParams({\n          drawing: 'off',\n        }),\n      ])\n    }\n  }\n\n  await flush()\n}\n",
    "src/utils.ts": "import { ITEMS_IN_SPACE, SPACES } from './consts'\n\n// -------------- utils -----------------\n// const info = console.info\nexport const info = (...args: any[]) => {}\n\nexport const toParams = (obj: Record<string, any>, prefix = ''): string[] => {\n  let array: string[] = []\n  Object.entries(obj).map(([k, v]) => {\n    const nextPrefix = prefix && k ? prefix + '.' + k : k || prefix\n    if (typeof v === 'object' && v !== null) {\n      array.push(...toParams(v, nextPrefix))\n    } else {\n      array.push(`${nextPrefix}=${v}`)\n    }\n  })\n  return array\n}\n\nexport type WindowData = number[][]\nexport const toDataId = (windowGroups: WindowData) => {\n  const id = `data.${new Array(SPACES)\n    .fill(undefined)\n    .map((_, spaceIndex) => {\n      return new Array(ITEMS_IN_SPACE)\n        .fill(undefined)\n        .map((_, windowIndex) => {\n          const window = windowGroups[spaceIndex]?.[windowIndex]\n          return window || 0\n        })\n        .join(':')\n    })\n    .join('/')}`\n  return id\n}\n\nexport const fromDataId = (id: string): WindowData => {\n  try {\n    const [prefix, data] = id.split('.')\n    if (prefix !== 'data') {\n      throw new Error('Invalid database id')\n    }\n    const windowGroups = data.split('/').map((space) => {\n      return space.split(':').map((window) => {\n        return parseInt(window)\n      })\n    })\n    return windowGroups\n  } catch (error) {\n    console.error('failed to parse database id', id, error)\n    return []\n  }\n}\n",
    "src/yabai.ts": "export type Display = {\n  id: string\n}\nexport type Space = {\n  id: string\n  index: number\n  windows: string[]\n  ['is-visible']: boolean\n}\nexport type Window = {\n  id: number\n  app: string\n  title: string\n  ['is-floating']: boolean\n  ['is-sticky']: boolean\n  ['is-topmost']: boolean\n  ['has-fullscreen-zoom']: boolean\n}\n",
    "tsconfig.json": "{\n  \"compilerOptions\": {\n    /* Visit https://aka.ms/tsconfig to read more about this file */\n\n    /* Projects */\n    // \"incremental\": true,                              /* Save .tsbuildinfo files to allow for incremental compilation of projects. */\n    // \"composite\": true,                                /* Enable constraints that allow a TypeScript project to be used with project references. */\n    // \"tsBuildInfoFile\": \"./.tsbuildinfo\",              /* Specify the path to .tsbuildinfo incremental compilation file. */\n    // \"disableSourceOfProjectReferenceRedirect\": true,  /* Disable preferring source files instead of declaration files when referencing composite projects. */\n    // \"disableSolutionSearching\": true,                 /* Opt a project out of multi-project reference checking when editing. */\n    // \"disableReferencedProjectLoad\": true,             /* Reduce the number of projects loaded automatically by TypeScript. */\n\n    /* Language and Environment */\n    \"target\": \"esnext\" /* Set the JavaScript language version for emitted JavaScript and include compatible library declarations. */,\n    // \"lib\": [],                                        /* Specify a set of bundled library declaration files that describe the target runtime environment. */\n    // \"jsx\": \"preserve\",                                /* Specify what JSX code is generated. */\n    // \"experimentalDecorators\": true,                   /* Enable experimental support for TC39 stage 2 draft decorators. */\n    // \"emitDecoratorMetadata\": true,                    /* Emit design-type metadata for decorated declarations in source files. */\n    // \"jsxFactory\": \"\",                                 /* Specify the JSX factory function used when targeting React JSX emit, e.g. 'React.createElement' or 'h'. */\n    // \"jsxFragmentFactory\": \"\",                         /* Specify the JSX Fragment reference used for fragments when targeting React JSX emit e.g. 'React.Fragment' or 'Fragment'. */\n    // \"jsxImportSource\": \"\",                            /* Specify module specifier used to import the JSX factory functions when using 'jsx: react-jsx*'. */\n    // \"reactNamespace\": \"\",                             /* Specify the object invoked for 'createElement'. This only applies when targeting 'react' JSX emit. */\n    // \"noLib\": true,                                    /* Disable including any library files, including the default lib.d.ts. */\n    // \"useDefineForClassFields\": true,                  /* Emit ECMAScript-standard-compliant class fields. */\n    // \"moduleDetection\": \"auto\",                        /* Control what method is used to detect module-format JS files. */\n\n    /* Modules */\n    \"module\": \"ESNext\",\n    \"rootDir\": \"./src\" /* Specify the root folder within your source files. */,\n    \"moduleResolution\": \"node\" /* Specify how TypeScript looks up a file from a given module specifier. */,\n    // \"baseUrl\": \"./\",                                  /* Specify the base directory to resolve non-relative module names. */\n    // \"paths\": {},                                      /* Specify a set of entries that re-map imports to additional lookup locations. */\n    // \"rootDirs\": [],                                   /* Allow multiple folders to be treated as one when resolving modules. */\n    // \"typeRoots\": [],                                  /* Specify multiple folders that act like './node_modules/@types'. */\n    // \"types\": [],                                      /* Specify type package names to be included without being referenced in a source file. */\n    // \"allowUmdGlobalAccess\": true,                     /* Allow accessing UMD globals from modules. */\n    // \"moduleSuffixes\": [],                             /* List of file name suffixes to search when resolving a module. */\n    // \"resolveJsonModule\": true,                        /* Enable importing .json files. */\n    // \"noResolve\": true,                                /* Disallow 'import's, 'require's or '<reference>'s from expanding the number of files TypeScript should add to a project. */\n\n    /* JavaScript Support */\n    // \"allowJs\": true /* Allow JavaScript files to be a part of your program. Use the 'checkJS' option to get errors from these files. */,\n    // \"checkJs\": true /* Enable error reporting in type-checked JavaScript files. */,\n    // \"maxNodeModuleJsDepth\": 1,                        /* Specify the maximum folder depth used for checking JavaScript files from 'node_modules'. Only applicable with 'allowJs'. */\n\n    /* Emit */\n    // \"declaration\": true,                              /* Generate .d.ts files from TypeScript and JavaScript files in your project. */\n    // \"declarationMap\": true,                           /* Create sourcemaps for d.ts files. */\n    // \"emitDeclarationOnly\": true,                      /* Only output d.ts files and not JavaScript files. */\n    // \"sourceMap\": true,                                /* Create source map files for emitted JavaScript files. */\n    // \"outFile\": \"./\",                                  /* Specify a file that bundles all outputs into one JavaScript file. If 'declaration' is true, also designates a file that bundles all .d.ts output. */\n    \"outDir\": \"./dist\" /* Specify an output folder for all emitted files. */,\n    // \"removeComments\": true,                           /* Disable emitting comments. */\n    // \"noEmit\": true,                                   /* Disable emitting files from a compilation. */\n    // \"importHelpers\": true,                            /* Allow importing helper functions from tslib once per project, instead of including them per-file. */\n    // \"importsNotUsedAsValues\": \"remove\",               /* Specify emit/checking behavior for imports that are only used for types. */\n    // \"downlevelIteration\": true,                       /* Emit more compliant, but verbose and less performant JavaScript for iteration. */\n    // \"sourceRoot\": \"\",                                 /* Specify the root path for debuggers to find the reference source code. */\n    // \"mapRoot\": \"\",                                    /* Specify the location where debugger should locate map files instead of generated locations. */\n    // \"inlineSourceMap\": true,                          /* Include sourcemap files inside the emitted JavaScript. */\n    // \"inlineSources\": true,                            /* Include source code in the sourcemaps inside the emitted JavaScript. */\n    // \"emitBOM\": true,                                  /* Emit a UTF-8 Byte Order Mark (BOM) in the beginning of output files. */\n    // \"newLine\": \"crlf\",                                /* Set the newline character for emitting files. */\n    // \"stripInternal\": true,                            /* Disable emitting declarations that have '@internal' in their JSDoc comments. */\n    // \"noEmitHelpers\": true,                            /* Disable generating custom helper functions like '__extends' in compiled output. */\n    // \"noEmitOnError\": true,                            /* Disable emitting files if any type checking errors are reported. */\n    // \"preserveConstEnums\": true,                       /* Disable erasing 'const enum' declarations in generated code. */\n    // \"declarationDir\": \"./\",                           /* Specify the output directory for generated declaration files. */\n    // \"preserveValueImports\": true,                     /* Preserve unused imported values in the JavaScript output that would otherwise be removed. */\n\n    /* Interop Constraints */\n    // \"isolatedModules\": true,                          /* Ensure that each file can be safely transpiled without relying on other imports. */\n    // \"allowSyntheticDefaultImports\": true,             /* Allow 'import x from y' when a module doesn't have a default export. */\n    \"esModuleInterop\": true /* Emit additional JavaScript to ease support for importing CommonJS modules. This enables 'allowSyntheticDefaultImports' for type compatibility. */,\n    // \"preserveSymlinks\": true,                         /* Disable resolving symlinks to their realpath. This correlates to the same flag in node. */\n    \"forceConsistentCasingInFileNames\": true /* Ensure that casing is correct in imports. */,\n\n    /* Type Checking */\n    \"strict\": true /* Enable all strict type-checking options. */,\n    // \"noImplicitAny\": true,                            /* Enable error reporting for expressions and declarations with an implied 'any' type. */\n    // \"strictNullChecks\": true,                         /* When type checking, take into account 'null' and 'undefined'. */\n    // \"strictFunctionTypes\": true,                      /* When assigning functions, check to ensure parameters and the return values are subtype-compatible. */\n    // \"strictBindCallApply\": true,                      /* Check that the arguments for 'bind', 'call', and 'apply' methods match the original function. */\n    // \"strictPropertyInitialization\": true,             /* Check for class properties that are declared but not set in the constructor. */\n    // \"noImplicitThis\": true,                           /* Enable error reporting when 'this' is given the type 'any'. */\n    // \"useUnknownInCatchVariables\": true,               /* Default catch clause variables as 'unknown' instead of 'any'. */\n    // \"alwaysStrict\": true,                             /* Ensure 'use strict' is always emitted. */\n    // \"noUnusedLocals\": true,                           /* Enable error reporting when local variables aren't read. */\n    // \"noUnusedParameters\": true,                       /* Raise an error when a function parameter isn't read. */\n    // \"exactOptionalPropertyTypes\": true,               /* Interpret optional property types as written, rather than adding 'undefined'. */\n    // \"noImplicitReturns\": true,                        /* Enable error reporting for codepaths that do not explicitly return in a function. */\n    // \"noFallthroughCasesInSwitch\": true,               /* Enable error reporting for fallthrough cases in switch statements. */\n    // \"noUncheckedIndexedAccess\": true,                 /* Add 'undefined' to a type when accessed using an index. */\n    // \"noImplicitOverride\": true,                       /* Ensure overriding members in derived classes are marked with an override modifier. */\n    // \"noPropertyAccessFromIndexSignature\": true,       /* Enforces using indexed accessors for keys declared using an indexed type. */\n    // \"allowUnusedLabels\": true,                        /* Disable error reporting for unused labels. */\n    // \"allowUnreachableCode\": true,                     /* Disable error reporting for unreachable code. */\n\n    /* Completeness */\n    // \"skipDefaultLibCheck\": true,                      /* Skip type checking .d.ts files that are included with TypeScript. */\n    \"skipLibCheck\": true /* Skip type checking all .d.ts files. */\n  }\n}\n"
  },
  "createdAt": "2023-01-29"
}